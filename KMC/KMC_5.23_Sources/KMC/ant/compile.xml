<?xml version="1.0" encoding="utf-8"?>
<!--
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Modified by Akvelon Inc.
 2014-06-30
 http://www.akvelon.com/contact-us
-->

<project name="KMC Compiler" basedir="./.." default="build">
	
	<!-- path to Flex SDK -->
    <property name="FLEX_HOME" value="C:/Program Files (x86)/Adobe/Adobe Flash Builder 4.6/sdks/3.5.0"/>
	
	<!-- directory for the compiled swf -->
    <property name="DEPLOY_DIR" value="${basedir}/bin-release"/>
	
	<property name="KMC_VERSION" value="v5.23.2"/>
	<property name="KDP_VERSION" value="v3.6.11"/>
	<property name="KCLIP_VERSION" value="v1.1.2.1"/>
	
	<!-- include flex tasks -->
	<taskdef resource="flexTasks.tasks" classpath="${FLEX_HOME}/ant/lib/flexTasks.jar" />
	
	<!--  -->
	<target name="build" description="general build" depends="clean, init, compile_locales, compile, pack">
		
		<length property="length" mode="each">
		    <fileset dir="${basedir}/../${KMC_VERSION}" >
				<exclude name="**/locale/**"/>
				<include name="**/*.swf"/>
			</fileset>
		</length>
		<echo>${length}</echo>

		<sound>
			<success source="C:/WINDOWS/media/tada.wav"/>
			<fail source="C:/WINDOWS/media"/>
		</sound>
		<echo>WOOHOO! KMC is ready!</echo>
	</target>
	
	
	<target name="create_keys_locale" description="set 'keys' locale files" >
		<ant antfile="ant/generateKeysLocaleSources.xml" target="build" >
			<property name="basedir" value="${basedir}"/>
		</ant> 
		<ant antfile="ant/generateKeysLocaleSources.xml" target="build" > 
			<property name="basedir" value="${basedir}/../KedLib"/>
		</ant> 
		<ant antfile="ant/generateKeysLocaleSources.xml" target="build" > 
			<property name="basedir" value="${basedir}/../KalturaLib"/>
		</ant> 
	</target>
		
	<target name="compile_locales" description="compile locale files" depends="create_keys_locale">
		<ant antfile="ant/compileLocale.xml" target="build">
			<property name="LANGUAGE" value="en_US"/>
		</ant> 
		<ant antfile="ant/compileLocale.xml" target="build">
			<property name="LANGUAGE" value="ja_JP"/>
		</ant> 
		<ant antfile="ant/compileLocale.xml" target="build">
			<property name="LANGUAGE" value="keys"/>
		</ant> 
	</target>
	
	<target name="compile" description="compile release build of KMC and drilldown panels">
		<fb.exportReleaseBuild project="KMC" /> 
		<echo>KMC release build created</echo>
		<fb.exportReleaseBuild project="KedPanels" destdir="${DEPLOY_DIR}" /> 
		<echo>Ked Panels release build created</echo>
	</target>
			
	<target name="pack" description="copy all version files to version folder">
		<ant antfile="ant/packVersion.xml" target="build" >
			<property name="PACK_SOURCE_DIR" value="${DEPLOY_DIR}"/>
		</ant>
	</target>
	
	
	<target name="clean" description="delete old files">
        <delete failonerror="false">
            <fileset dir="${DEPLOY_DIR}" includes="**/*"/>
        </delete>
    </target>
	
	
	<target name="init">
		<mkdir dir="${DEPLOY_DIR}" description="Make sure there is a bin directory"/>
		<mkdir dir="${DEPLOY_DIR}/modules" description="Make sure there is a bin directory"/>
		<mkdir dir="${DEPLOY_DIR}/modules/ked" description="Make sure there is a bin directory"/>
	</target>
	
</project>

